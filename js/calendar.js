/*! <anderpang@foxmail.com> */"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():e.Calendar=t()}(this,function(){function e(e){this.config(e||{}).init().triggerSelected()}return e.prototype={noop:function(){},checkDate:function(e,t){return!(e<t[0]||e>t[1])},getDateFromObj:function(e){return 1e4*e.getFullYear()+100*(e.getMonth()+1)+e.getDate()},config:function(e){var t,a,i,n,s=document,l=e.limits,d=[10000101,99990101];return this.el="string"==typeof e.el?s.querySelector(e.el):e.el,"number"==typeof(t=e.today)?this.checkDate(t,d)?this._today=t:this._today=this.getDateFromObj(new Date):t instanceof Date?this._today=this.getDateFromObj(t):this._today=this.getDateFromObj(new Date),"number"==typeof(n=e.selected)?this._selected_day=n:n instanceof Date?this._selected_day=this.getDateFromObj(n):this._selected_day=0,this._limits=d,l&&("number"==typeof(n=l[0])?n>d[0]&&n<d[1]&&(d[0]=n):n instanceof Date&&(d[0]=this.getDateFromObj(n)),"number"==typeof(n=l[1])?n>d[0]&&n<d[1]&&(d[1]=n):n instanceof Date&&(d[1]=this.getDateFromObj(n)),d[0]>d[1]&&(d[0]+=d[1],d[1]=d[0]-d[1],d[0]-=d[1])),i=((n=Math.max(this._today,d[0]))-1e4*(a=n/1e4|0))/100-1|0,this._cur_date=[a,i],this._showIndex=0,this.onSelected=e.onSelected||this.noop,this.onCellRender=e.onCellRender||this.noop,this},init:function(){var a=document.createElement("div"),e=function(e){var t=a.cloneNode(!0);return t.className=e,t},t=e("cld-header"),i=e("cld-main"),n=e("cld-year-bar"),s=e("cld-date-bar"),l=e("cld-mon-bar"),d=e("cld-week-bar"),r=e("cld-date-inner cld-anim"),c=e("cld-year-show"),h=e("cld-mon-show"),o=e("cld-today-show"),u=[this.initDateShow()];return u[1]=u[0].cloneNode(!0),u[2]=u[0].cloneNode(!0),this.header=t,this.main=i,this.yearBar=n,this.monthBar=l,this.dateInner=r,this.yearShow=c,this.monShow=h,this.shows=u,o.innerHTML="今天",t.appendChild(e("cld-move-left")),t.appendChild(c),t.appendChild(h),t.appendChild(o),t.appendChild(e("cld-move-right")),this.initWeek(d).fillDate(u[0],0).fillDate(u[1],1).fillDate(u[2],-1).updateHeader(),r.appendChild(u[0]),r.appendChild(u[1]),r.appendChild(u[2]),s.appendChild(d),s.appendChild(r),i.appendChild(n),i.appendChild(s),i.appendChild(l),a.appendChild(t),a.appendChild(i),a.className="calendar-wrap",a.addEventListener("click",this,!1),void 0!==s.ontouchstart?(this.evts.touchcancel=this.evts.touchend,s.addEventListener("touchstart",this,!1),s.addEventListener("touchmove",this,!1),s.addEventListener("touchend",this,!1),s.addEventListener("touchcancel",this,!1)):(this.evts.mouseleave=this.evts.mouseup,s.addEventListener("mousedown",this,!1),s.addEventListener("mousemove",this,!1),s.addEventListener("mouseup",this,!1),s.addEventListener("mouseleave",this,!1)),this.el.appendChild(a),this},handleEvent:function(e){var t,a,i=e.type;if("click"===i){if(this._disableClick)return void(this._disableClick=!1);(a=(t=e.target).className)&&("cld-date-cell cld-date-today"===a?this.evts["cld-date-cell"].call(this,t,e):this.evts[a]&&this.evts[a].call(this,t,e))}else this.evts[i]&&this.evts[i].call(this,e)},evts:{"cld-date-cell":function(e,t){var a,i=e._date;t.preventDefault(),t.stopPropagation(),this._selected_day=i,(a=this.dateInner.querySelector(".cld-date-sel"))&&a.classList.remove("cld-date-sel"),e.classList.add("cld-date-sel"),this.triggerSelected()},"cld-move-left":function(e,t){var a=--this._showIndex,i=this._cur_date,n=i[0],s=i[1];t.stopPropagation(),1e3!==n||0!==s?(this.setTranslate(this.dateInner,"translate3d("+-100*a+"%,0,0)"),0===s?(s=11,i[0]--):s--,this.changeMonth(s).updateHeader().fillDate(this.shows[(a%3+3-1)%3],-1)):this._showIndex++},"cld-move-right":function(e,t){var a=++this._showIndex,i=this._cur_date,n=i[0],s=i[1];t.stopPropagation(),9999!==n||11!==s?(this.setTranslate(this.dateInner,"translate3d("+-100*a+"%,0,0)"),11===s?i[s=0]++:s++,this.changeMonth(s).updateHeader().fillDate(this.shows[(a%3+3+1)%3],1)):this._showIndex--},"cld-year-show":function(e,t){var a=this._cur_date[0],i=this.main,n=this.yearBar.childElementCount;t.stopPropagation(),this._year_page=0,n?this.fillYear(a,0):this.initYearBar(a),this.setTranslate(i,"translate3d(0,100%,0)")},"cld-mon-show":function(e,t){var a,i,n=this._cur_date[1],s=this.main,l=this.monthBar.childElementCount;t.stopPropagation(),l?(i=this.monInner.querySelector(".cld-cur-mon"))!==(a=this.monInner.children)[n]&&(i.classList.remove("cld-cur-mon"),a[n].classList.add("cld-cur-mon")):this.initMonthBar(n),this.setTranslate(s,"translate3d(0,-100%,0)")},"cld-today-show":function(e,t){var a=this._cur_date,i=this._today,n=i/1e4|0,s=(i-1e4*n)/100-1|0;t.stopPropagation(),a[0]!==n||a[1]!==s?(a[0]=n,a[1]=s,this.dateReset().updateHeader().moveToDateBar()):this.moveToDateBar()},"cld-back-btn":function(e,t){t.stopPropagation(),this.moveToDateBar()},"cld-year-prev":function(e,t){var a=this._cur_date[0];t.stopPropagation(),this._year_page++,this.fillYear(a,-1)},"cld-year-next":function(e,t){var a=this._cur_date[0];t.stopPropagation(),this._year_page--,this.fillYear(a,1)},"cld-year-cell":function(e,t){var a=this._cur_date,i=1*e.innerHTML;a[0]=i,a[1]=0,this.dateReset().updateHeader().moveToDateBar()},"cld-mon-cell":function(e,t){var a=this._cur_date,i=e.innerHTML-1;a[1]=i,this.dateReset().updateHeader().moveToDateBar()},mousedown:function(e){var t=e.currentTarget;this._ow=t.clientWidth,this._cy=e.clientY,this._cx=e.clientX,this._startTime=e.timeStamp,this._is_down=!0,this._disableClick=!1,this.dateInner.classList.remove("cld-anim")},mousemove:function(e){if(this._is_down){var t=e.clientY-this._cy,a=e.clientX-this._cx,i=Math.abs(a);Math.abs(t)<i&&this.setTranslate(this.dateInner,"translate3d("+(-this._showIndex*this._ow+a-i/(2*this._ow)*a)+"px,0,0)")}},mouseup:function(e){if(this._is_down){var t=this.dateInner,a=Math.abs(e.clientY-this._cy),i=e.clientX-this._cx,n=Math.abs(i),s=e.timeStamp-this._startTime,l=100*this._cur_date[0]+this._cur_date[1];if(e.stopPropagation(),this._is_down=!1,t.classList.add("cld-anim"),t.offsetWidth,a<n&&(s<300||n>.2*this._ow))if(this._disableClick=!0,0<i){if(1e5!==l)return void this.evts["cld-move-left"].call(this,t,e)}else if(999911!==l)return void this.evts["cld-move-right"].call(this,t,e);this.setTranslate(t,"translate3d("+-100*this._showIndex+"%,0,0)"),5<a+n&&(this._disableClick=!0)}},touchstart:function(e){var t=e.targetTouches[0];e.clientX=t.clientX,e.clientY=t.clientY,this.evts.mousedown.call(this,e)},touchmove:function(e){var t=e.targetTouches[0];e.clientX=t.clientX,e.clientY=t.clientY,this.evts.mousemove.call(this,e)},touchend:function(e){var t=e.changedTouches[0];e.clientX=t.clientX,e.clientY=t.clientY,this.evts.mouseup.call(this,e),this._disableClick=!1}},setTranslate:function(e,t){return e.style.transform=e.style.webkitTransform=t,this},moveToDateBar:function(){return this.setTranslate(this.main,"translate3d(0,0,0)"),this},initDateShow:function(){var e=document.createElement("div"),t=e.cloneNode(!1),a=41;for(t.className="cld-date-cell",e.className="cld-date-show",e.appendChild(t);a--;)e.appendChild(t.cloneNode(!0));return e},weeks:["日","一","二","三","四","五","六"],initWeek:function(e){var t=document.createElement("span"),a=this.weeks,i=1,n=a.length;for(t.className="cld-week-cell",t.innerHTML=a[0],e.appendChild(t);i<n;i++)(t=t.cloneNode(!0)).innerHTML=a[i],e.appendChild(t);return this},fillDate:function(e,t){var a,i,n,s,l,d=this._today,r=this._showIndex,c=this._selected_day,h=!!c,o=this._cur_date,u=o[0],p=o[1],m=1,_=0,f=e.children,v=f.length,y=this.onCellRender,g=this._limits[0],w=this._limits[1];if(e.style.display="none",(p+=t)<0?(p=11,u--):11<p&&(p=0,u++),p+=1,u<1e3||9999<u)return this;for(i=(a=new Date(u,p,0)).getDate(),n=(a.getDay()+8-i%7)%7,e._date=100*u+p;_<n;_++)(s=f[_]).innerHTML="",s.className="cld-date-cell cld-date-disabled",y(s,0);for(;m<=i;_++,m++)l=1e4*u+100*p+m,(s=f[_]).innerHTML=m,s._date=l,s.className=l===d?h&&l===c?"cld-date-cell cld-date-today cld-date-sel":"cld-date-cell cld-date-today":l===c?"cld-date-cell cld-date-sel":"cld-date-cell",(l<g||w<l)&&s.classList.add("cld-date-limit"),y(s,u,p,m);for(;_<v;_++)(s=f[_]).innerHTML="",s.className="cld-date-cell cld-date-disabled",y(s,0);return e.style.left=100*(t+r)+"%",e.style.display="",this},updateHeader:function(){var e=this._cur_date;return this.yearShow.innerHTML=e[0],this.monShow.innerHTML=e[1]+1,this},changeMonth:function(e){return this._cur_date[1]=e,this},initYearBar:function(e){var t=document,a=t.createElement("span"),i=this.yearBar,n=i.cloneNode(!1),s=n.cloneNode(!1),l=a.cloneNode(!1),d=t.createDocumentFragment(),r=0;for(n.className="cld-year-header",n.innerHTML="选择年份",l.className="cld-back-btn",l.innerHTML="返回",n.appendChild(l),d.appendChild(n),s.className="cld-year-inner",a.className="cld-year-prev",a.innerHTML="往前",s.appendChild(a);r<10;r++)a=a.cloneNode(!1),s.appendChild(a);return(a=a.cloneNode(!1)).className="cld-year-next",a.innerHTML="往后",s.appendChild(a),d.appendChild(s),this.yearInner=s,this._year_page=0,i.appendChild(d),this.fillYear(e,0)},fillYear:function(e,t){var a,i,n,s=e-e%10,l=0;if((s-=10*this._year_page)<1e3||9999<s)return this._year_page+=t,this;for(a=this.yearInner.children;l<10;l++)n=s+l,(i=a[l+1]).innerHTML=n,i.className=e===n?"cld-year-cell cld-cur-year":"cld-year-cell";return this},dateReset:function(){var e=this.shows,t=this.dateInner;return this._showIndex=0,t.style.display="none",this.fillDate(e[0],0).fillDate(e[1],1).fillDate(e[2],-1).setTranslate(t,"translate3d(0,0,0)"),t.offsetHeight,t.style.display="",this},initMonthBar:function(e){var t=document,a=t.createElement("span"),i=this.monthBar,n=i.cloneNode(!1),s=n.cloneNode(!1),l=a.cloneNode(!1),d=t.createDocumentFragment(),r=0;for(n.className="cld-mon-header",n.innerHTML="选择月份",l.className="cld-back-btn",l.innerHTML="返回",n.appendChild(l),d.appendChild(n),s.className="cld-mon-inner";r<12;a=a.cloneNode(!1),r++)a.innerHTML=r+1,a.className=r===e?"cld-mon-cell cld-cur-mon":"cld-mon-cell",s.appendChild(a);return d.appendChild(s),this.monInner=s,i.appendChild(d),this},triggerSelected:function(){if(!this._selected_day)return this;var e=this._selected_day,t=e/1e4|0,a=(e-1e4*t)/100|0,i=e%100;return this.onSelected(t,a,i),this}},e});
